Modified version of http://g3d.cs.williams.edu/g3d/www/index.html

Mostly fixed bugs found by valgrind.
